<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Trebuchet MS', monospace;
            background-color: #ffffff;
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        #game-container {
            text-align: center;
        }

        #level-info {
            margin-bottom: 20px;
            font-size: 18px;
        }

        #avatar-color-display {
            margin-bottom: 15px;
            font-size: 16px;
            padding: 10px;
            background-color: #2a2a2a;
            border-radius: 5px;
        }

        #color-indicator {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 2px solid #666;
            vertical-align: middle;
            margin-left: 10px;
        }

        #grid {
            display: inline-grid;
            grid-template-columns: repeat(6, 60px);
            grid-template-rows: repeat(6, 60px);
            gap: 2px;
            background-color: #ffffff;
            padding: 2px;
            border: 3px solid #666;
        }

        .cell {
            width: 60px;
            height: 60px;
            border: 1px solid #444;
            box-sizing: border-box;
        }

        #controls {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }

        #message {
            margin-top: 15px;
            font-size: 16px;
            height: 25px;
            color: #4CAF50;
        }

        #instructions {
            margin-top: 20px;
            max-width: 500px;
            text-align: left;
            color: #aaa;
            font-size: 13px;
            line-height: 1.6;
        }

        .color-legend {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #666;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="level-info">Level: <span id="current-level">1</span> | Moves: <span id="move-count">0</span></div>
        <div id="avatar-color-display">
            Avatar Color: <span id="color-name">White</span>
            <div id="color-indicator"></div>
        </div>
        <div id="grid"></div>
        <div id="message"></div>
        <div id="controls">Use Arrow Keys to move | R to restart level</div>

        <div class="color-legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFFFFF;"></div>
                <span>Avatar (White)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2196F3;"></div>
                <span>Blue Corner/Goal</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFEB3B;"></div>
                <span>Yellow Corner</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4CAF50;"></div>
                <span>Green Corner (Reset)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #E91E63;"></div>
                <span>Pink Corner</span>
            </div>
        </div>

        <div id="instructions">
            <strong>How to Play:</strong><br>
            Touch the colored corner blocks to change your avatar's color. The goal is to turn your avatar
            BLUE by touching the blue corner, then touch the blue box in the center to win.
            WARNING: Green resets you back to white! You must go directly from white→blue→center to win.
        </div>
    </div>

    <script>
        // Color definitions
        const COLORS = {
            EMPTY: '#0a0a0a',
            WHITE: '#FFFFFF',
            BLUE: '#2196F3',
            YELLOW: '#FFEB3B',
            GREEN: '#4CAF50',
            PINK: '#E91E63'
        };

        // Game state
        let levels = [];
        let currentLevelIndex = 0;
        let gameState = {
            grid: [],
            avatarPos: { x: 0, y: 0 },
            avatarColor: 'white',  // Track avatar color
            centerPos: { x: 0, y: 0 },  // Blue center box
            corners: {
                topLeft: { x: 0, y: 0, color: 'green' },      // Green (reset)
                topRight: { x: 5, y: 0, color: 'yellow' },    // Yellow
                bottomLeft: { x: 0, y: 5, color: 'pink' },    // Pink
                bottomRight: { x: 5, y: 5, color: 'blue' }    // Blue
            },
            moveCount: 0,
            colorHistory: ['white']  // Track color transitions
        };

        // Initialize grid display
        function initGrid() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = '';
            for (let y = 0; y < 6; y++) {
                for (let x = 0; x < 6; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${x}-${y}`;
                    gridElement.appendChild(cell);
                }
            }
        }

        // Load level
        function loadLevel(levelIndex) {
            if (levelIndex >= levels.length) {
                showMessage('Congratulations! You completed all levels!');
                return;
            }

            const level = levels[levelIndex];
            gameState.grid = level.grid.map(row => [...row]);
            gameState.avatarPos = { ...level.avatar };
            gameState.centerPos = { ...level.center };
            gameState.avatarColor = 'white';
            gameState.colorHistory = ['white'];
            gameState.moveCount = 0;

            document.getElementById('current-level').textContent = levelIndex + 1;
            document.getElementById('move-count').textContent = 0;
            updateColorDisplay();
            showMessage('');

            renderGrid();
        }

        // Update color display
        function updateColorDisplay() {
            const colorName = gameState.avatarColor.charAt(0).toUpperCase() + gameState.avatarColor.slice(1);
            document.getElementById('color-name').textContent = colorName;
            const indicator = document.getElementById('color-indicator');
            indicator.style.backgroundColor = COLORS[gameState.avatarColor.toUpperCase()];
        }

        // Get color at position
        function getColorAtPosition(x, y) {
            // Check corners
            if (x === 0 && y === 0) return 'green';
            if (x === 5 && y === 0) return 'yellow';
            if (x === 0 && y === 5) return 'pink';
            if (x === 5 && y === 5) return 'blue';

            // Check center
            if (x === gameState.centerPos.x && y === gameState.centerPos.y) return 'center';

            return null;
        }

        // Render the grid
        function renderGrid() {
            for (let y = 0; y < 6; y++) {
                for (let x = 0; x < 6; x++) {
                    const cell = document.getElementById(`cell-${x}-${y}`);
                    let color = COLORS.EMPTY;

                    // Draw corner blocks
                    if (x === 0 && y === 0) color = COLORS.GREEN;
                    else if (x === 5 && y === 0) color = COLORS.YELLOW;
                    else if (x === 0 && y === 5) color = COLORS.PINK;
                    else if (x === 5 && y === 5) color = COLORS.BLUE;

                    // Draw center block
                    else if (x === gameState.centerPos.x && y === gameState.centerPos.y) {
                        color = COLORS.BLUE;
                    }

                    // Draw avatar (on top)
                    if (gameState.avatarPos.x === x && gameState.avatarPos.y === y) {
                        color = COLORS[gameState.avatarColor.toUpperCase()];
                    }

                    cell.style.backgroundColor = color;
                }
            }
        }

        // Check if position is valid
        function isValidPosition(x, y) {
            if (x < 0 || x >= 6 || y < 0 || y >= 6) return false;
            return true;
        }

        // Check win condition
        function checkWinCondition() {
            // Must be on center position
            if (gameState.avatarPos.x !== gameState.centerPos.x ||
                gameState.avatarPos.y !== gameState.centerPos.y) {
                return false;
            }

            // Must be blue
            if (gameState.avatarColor !== 'blue') {
                return false;
            }

            // Check color history: must go white -> blue -> center
            const history = gameState.colorHistory;

            // Find the last time we were white
            let lastWhiteIndex = -1;
            for (let i = history.length - 1; i >= 0; i--) {
                if (history[i] === 'white') {
                    lastWhiteIndex = i;
                    break;
                }
            }

            // Check if we went directly from white to blue (no other colors in between)
            if (lastWhiteIndex === -1) return false;

            for (let i = lastWhiteIndex + 1; i < history.length; i++) {
                if (history[i] !== 'blue') {
                    return false;
                }
            }

            return true;
        }

        // Move avatar
        function moveAvatar(dx, dy) {
            const newX = gameState.avatarPos.x + dx;
            const newY = gameState.avatarPos.y + dy;

            if (!isValidPosition(newX, newY)) {
                return;
            }

            // Move avatar
            gameState.avatarPos.x = newX;
            gameState.avatarPos.y = newY;
            gameState.moveCount++;

            // Check if avatar touched a color-changing corner
            const colorAt = getColorAtPosition(newX, newY);

            if (colorAt && colorAt !== 'center') {
                const oldColor = gameState.avatarColor;
                gameState.avatarColor = colorAt;
                gameState.colorHistory.push(colorAt);
                updateColorDisplay();

                if (colorAt === 'green') {
                    showMessage('Reset to white!');
                    setTimeout(() => showMessage(''), 1000);
                }
            }

            document.getElementById('move-count').textContent = gameState.moveCount;
            renderGrid();

            // Check win condition when on center
            if (colorAt === 'center') {
                if (checkWinCondition()) {
                    showMessage('Level Complete! Advancing...');
                    setTimeout(() => {
                        currentLevelIndex++;
                        loadLevel(currentLevelIndex);
                    }, 1500);
                } else {
                    showMessage('Wrong! You must go white→blue→center!');
                    setTimeout(() => showMessage(''), 2000);
                }
            }
        }

        // Show message
        function showMessage(msg) {
            document.getElementById('message').textContent = msg;
        }

        // Handle keyboard input
        document.addEventListener('keydown', (e) => {
            if (currentLevelIndex >= levels.length) return;

            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    moveAvatar(0, -1);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    moveAvatar(0, 1);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    moveAvatar(-1, 0);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    moveAvatar(1, 0);
                    break;
                case 'r':
                case 'R':
                    e.preventDefault();
                    loadLevel(currentLevelIndex);
                    showMessage('Level restarted');
                    setTimeout(() => showMessage(''), 1000);
                    break;
            }
        });

        // Level data
        levels = [
            {
                id: 1,
                name: "Tutorial",
                grid: [
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0]
                ],
                avatar: { x: 2, y: 2 },
                center: { x: 3, y: 3 }
            },
            {
                id: 2,
                name: "The Path",
                grid: [
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0]
                ],
                avatar: { x: 1, y: 1 },
                center: { x: 2, y: 3 }
            },
            {
                id: 3,
                name: "Careful Navigation",
                grid: [
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0]
                ],
                avatar: { x: 1, y: 3 },
                center: { x: 3, y: 2 }
            }
        ];

        // Start game
        initGrid();
        loadLevel(0);
    </script>
</body>
</html>
